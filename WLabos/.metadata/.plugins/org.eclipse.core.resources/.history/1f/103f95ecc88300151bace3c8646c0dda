package datamanagement.labo2.indexing;

import java.io.IOException;
import java.nio.file.FileSystems;

import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.document.FieldType;
import org.apache.lucene.document.IntField;
import org.apache.lucene.index.IndexOptions;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.IndexWriterConfig;
import org.apache.lucene.index.IndexWriterConfig.OpenMode;
import org.apache.lucene.search.similarities.DefaultSimilarity;
import org.apache.lucene.store.FSDirectory;

public class lab2Indexer {

	private IndexWriter iwriter;
	private String filePath;
	private Analyzer analyzer;
	private DefaultSimilarity similarity;
	private FieldType fieldTypeID;
	private FieldType fieldTypeContent;
	
	private static final int ID = 0;
	private static final int CONTENT = 1;
	public static final String IDFIELD = "id";
	public static final String SUMMARYFIELD = "content";
	public static final String INDEXDIR = "index";
	
	public Lab2Indexer(Analyzer analyzer, String path) {
    	this.analyzer = analyzer;
    	this.filePath = path;
    	this.similarity = null;
    	createAndConfigureWriter();
    	createAndConfigureFieldType();
    }
    

	public Lab2Indexer(Analyzer analyzer, String path, DefaultSimilarity similarity) {
    	this(analyzer,path);
    	this.similarity = similarity;
    	createAndConfigureWriter();
    }
	
	private void createAndConfigureFieldType() {
		IntField ft = new IntField();
		ft.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS); // Indexes documents, frequencies, positions and offsets.
		ft.setTokenized(true);
		ft.setStored(true);
		
		ft.setStoreTermVectors(true);
		ft.setStoreTermVectorPositions(true);
		ft.setStoreTermVectorOffsets(true);
		
		ft.freeze();
		
		fieldType = ft;
	}
    
    private void createAndConfigureWriter() {
    	IndexWriterConfig indexWriterConf = new IndexWriterConfig(analyzer);
    	indexWriterConf.setOpenMode(OpenMode.CREATE); // always create and replace existing index
    	indexWriterConf.setUseCompoundFile(false);
    	
    	if(null != similarity) indexWriterConf.setSimilarity(similarity);
    	
    	try {
			iwriter = new IndexWriter(FSDirectory.open(FileSystems.getDefault().getPath(INDEXDIR)), indexWriterConf);
    	} catch (IOException e) {
			System.out.println(e.getMessage());
		}
    }
}
